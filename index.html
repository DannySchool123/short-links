<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Link Shortener</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        input, button {
            margin: 10px;
            padding: 10px;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <h1>GitHub Link Shortener</h1>

    <div>
        <h3>Create Short Link</h3>
        <input id="originalLink" type="text" placeholder="Enter URL">
        <button onclick="createShortLink()">Create</button>
        <p id="shortLinkResult"></p>
    </div>

    <script>
        const GITHUB_USERNAME = "DannySchool123"; // Your GitHub username
        const REPO_NAME = "short-links"; // Your repository name
        const BRANCH_NAME = "main"; // Repository branch
        const FILE_NAME = "urlDatabase.json"; // File to store data
        const PAT = "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"; // Don't expose the PAT in the frontend

        const urlDatabase = {}; // Object to store URL mappings

        function generateShortCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) { // Generate a 6-character code
                code += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return code;
        }

        async function createShortLink() {
            const originalLink = document.getElementById('originalLink').value.trim();
            if (!originalLink) {
                alert("Please enter a valid URL!");
                return;
            }

            const shortCode = generateShortCode();
            urlDatabase[shortCode] = originalLink;

            try {
                const urlDatabaseJson = JSON.stringify(urlDatabase, null, 2);
                const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_NAME}`;
                const response = await fetch(apiUrl, {
                    method: "PUT",
                    headers: {
                        "Authorization": `Bearer ${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}`, // Authenticate with your PAT
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        message: "Update URL database",
                        content: btoa(urlDatabaseJson), // Encode data as Base64
                        branch: BRANCH_NAME
                    })
                });

                if (response.ok) {
                    document.getElementById('shortLinkResult').innerText = `Short Code: ${shortCode}`;
                    console.log("Data successfully saved to GitHub!");
                } else {
                    const error = await response.json();
                    console.error("GitHub API Error:", error.message);
                }
            } catch (error) {
                console.error("Error during GitHub API call:", error);
            }
        }
    </script>
</body>
</html>
